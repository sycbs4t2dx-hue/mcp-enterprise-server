# Claude 文档生成与维护规范

**版本**: 1.0
**生效日期**: 2025-11-20
**目标**: 避免文档泛滥，保持项目清洁度

---

## 🚨 核心原则

### 1. 最少文档原则
- **不要为每个修复创建文档**
- **不要为每个功能创建文档**
- **不要创建进度追踪文档**
- **只在必要时创建文档**

### 2. 报告生成禁令 🔴
- **绝对禁止创建任何报告文档**
- **所有报告必须输出到终端**
- **完成总结使用echo，不创建文件**
- **详见**: REPORT_GENERATION_BAN.md

### 3. 文档生命周期
- **临时文档**: 在代码注释中说明，不创建文件
- **永久文档**: 只保留核心架构和API文档
- **修复记录**: 在代码注释或commit message中记录

---

## 📁 文档目录结构规范

```
/项目根目录
├── README.md                 # 项目主文档（唯一入口）
├── CHANGELOG.md              # 版本更新日志（如果需要）
├── .claude/                  # Claude专用目录
│   ├── DOC_GENERATION_RULES.md  # 本规范文档
│   └── templates/            # 文档模板（如需要）
├── docs/                     # 核心文档目录（精简）
│   ├── API.md               # API文档（如果有公开API）
│   ├── ARCHITECTURE.md     # 架构设计（只保留最新版）
│   └── DEPLOYMENT.md        # 部署指南
└── .archived/               # 归档目录
    └── *.md                 # 旧文档移到这里

```

---

## ❌ 禁止创建的文档类型

### 1. 修复类文档
```
❌ 不要: BUG_FIX_2025-11-20.md
❌ 不要: SCHEMA_FIX_2025-11-20.md
❌ 不要: SESSION_ROLLBACK_FIX.md

✅ 改为: 在代码中添加注释
```

```python
# 修复: 2025-11-20 - Position对象属性访问错误
# 原因: javalang的Position是namedtuple而非dict
# 解决: 使用.line而非.get('line')
line_num = node.position.line if hasattr(node, 'position') else 0
```

### 2. 进度/状态文档
```
❌ 不要: PHASE_1_COMPLETE.md
❌ 不要: PROGRESS_2025-11-20.md
❌ 不要: TODO_COMPLETION.md

✅ 改为: 使用TodoWrite工具追踪
```

### 3. 重复性文档
```
❌ 不要: 为相同问题创建多个文档
❌ 不要: 每天创建新的总结文档
❌ 不要: 版本迭代文档（v1, v2, v3...）

✅ 改为: 更新现有文档
```

---

## ✅ 应该创建的文档

### 1. 架构变更
**条件**: 系统架构发生重大改变
**位置**: 更新 `docs/ARCHITECTURE.md`
**不是**: 创建新文件

### 2. 破坏性变更
**条件**: API或接口不兼容变更
**位置**: 更新 `CHANGELOG.md`
**格式**: 遵循 [Keep a Changelog](https://keepachangelog.com/)

### 3. 新系统/模块
**条件**: 全新的独立系统
**位置**: 在对应模块目录创建 `README.md`
**示例**: `src/new_module/README.md`

---

## 📝 文档更新策略

### 场景1: 修复Bug
```bash
# 不要创建文档
# 改为在代码中注释
git commit -m "fix: 修复Position属性访问错误

问题: javalang Position对象使用.get()方法失败
原因: Position是namedtuple而非dict
解决: 改用.line属性访问

影响: 修复88个Java文件分析失败问题"
```

### 场景2: 添加功能
```python
def new_feature():
    """新功能说明

    添加日期: 2025-11-20
    功能描述: ...
    使用方式: ...

    Example:
        >>> new_feature()
    """
    pass
```

### 场景3: 配置变更
```yaml
# config.yaml
# 变更记录:
# 2025-11-20: 移除不存在的tokenizer.json URL
# 原因: CodeBERT使用RoBERTa tokenizer
download_urls:
  # - ".../tokenizer.json"  # 2025-11-20: 文件不存在，已移除
```

---

## 🗂️ 文档归档规则

### 何时归档
1. 文档超过30天未更新
2. 文档描述的功能已废弃
3. 临时性文档（修复记录、进度报告）

### 如何归档
```bash
# 移动到归档目录
mv docs/OLD_DOC.md .archived/

# 不要删除，保留历史记录
```

---

## 🔍 文档检查清单

创建文档前，问自己：

1. **这是否可以写在代码注释里？** → 优先代码注释
2. **这是否可以写在commit message里？** → 优先commit
3. **是否有现有文档可以更新？** → 优先更新
4. **这个文档30天后还有价值吗？** → 如果没有，不要创建
5. **这是否是核心架构/API变更？** → 只有这种情况创建

---

## 📊 当前问题

- **文档总数**: 845个 ❌ 严重过多
- **docs目录**: 143个 ❌ 需要清理
- **今日新增**: 37个 ❌ 生成过快

### 建议操作
1. 归档90%的现有文档
2. 保留核心5-10个文档
3. 停止创建修复类文档
4. 使用代码注释代替文档

---

## 💡 黄金法则

> **如果不确定是否需要文档，就不要创建**

记住：
- 代码是最好的文档
- 注释胜过独立文档
- Commit message是历史记录
- 少即是多

---

## 🚀 立即执行

从现在开始：
1. **停止**为今天的修复创建新文档
2. **使用**代码注释记录修复
3. **更新**现有文档而非创建新文档
4. **归档**过时和临时文档

---

**强制执行**: 此规范立即生效，违反将被要求修正