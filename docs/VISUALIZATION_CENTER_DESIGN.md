# ğŸ¨ MCPçŸ¥è¯†å›¾è°±å¯è§†åŒ–ä¸­å¿ƒ - æ·±åº¦è®¾è®¡æ–¹æ¡ˆ

## æ ¸å¿ƒéœ€æ±‚åˆ†æ

### ç”¨æˆ·æƒ³è¦ä»€ä¹ˆï¼Ÿ
1. **æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®çš„çŸ¥è¯†å›¾è°±** - ç»Ÿä¸€çš„å¯è§†åŒ–å…¥å£
2. **æ—¶é—´æ—…è¡Œ** - æŸ¥çœ‹é¡¹ç›®åœ¨ä¸åŒæ—¶é—´ç‚¹çš„çŠ¶æ€
3. **å¯¹æ¯”åˆ†æ** - æ¯”è¾ƒä¸åŒé¡¹ç›®æˆ–ä¸åŒæ—¶é—´çš„å›¾è°±
4. **äº¤äº’æ¢ç´¢** - æ·±å…¥äº†è§£æ¯ä¸ªèŠ‚ç‚¹å’Œå…³ç³»
5. **çŸ¥è¯†å‘ç°** - ä»å›¾è°±ä¸­å‘ç°æ¨¡å¼å’Œæ´å¯Ÿ

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MCPçŸ¥è¯†å›¾è°±å¯è§†åŒ–ä¸­å¿ƒ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Webç•Œé¢     â”‚  â”‚  APIæœåŠ¡å™¨   â”‚           â”‚
â”‚  â”‚  (React)     â”‚â—„â”€â”¤  (FastAPI)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â–²                 â”‚                    â”‚
â”‚         â”‚                 â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  3Då¯è§†åŒ–    â”‚  â”‚  å›¾è°±æ•°æ®åº“   â”‚           â”‚
â”‚  â”‚  (Three.js)  â”‚  â”‚  (Neo4j)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â–²                 â”‚                    â”‚
â”‚         â”‚                 â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  æ—¶é—´è½´è§†å›¾   â”‚  â”‚  è®°å¿†å­˜å‚¨    â”‚           â”‚
â”‚  â”‚  (D3.js)     â”‚  â”‚  (SQLite)    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®ç°æ–¹æ¡ˆ

### 1. ç»Ÿä¸€å¯è§†åŒ–é—¨æˆ·

```python
# visualization_portal.py
class KnowledgeGraphPortal:
    """çŸ¥è¯†å›¾è°±å¯è§†åŒ–é—¨æˆ·"""

    def __init__(self):
        self.projects = {}  # æ‰€æœ‰é¡¹ç›®çš„å›¾è°±
        self.memories = {}  # æ‰€æœ‰é¡¹ç›®çš„è®°å¿†
        self.server = None

    async def initialize(self):
        """åˆå§‹åŒ–é—¨æˆ·"""
        # 1. æ‰«ææ‰€æœ‰é¡¹ç›®
        await self.scan_all_projects()

        # 2. åŠ è½½æ‰€æœ‰å›¾è°±
        await self.load_all_graphs()

        # 3. å¯åŠ¨WebæœåŠ¡å™¨
        await self.start_web_server()

    async def scan_all_projects(self):
        """æ‰«ææ‰€æœ‰MCPç®¡ç†çš„é¡¹ç›®"""
        # ä»é…ç½®æ–‡ä»¶è¯»å–é¡¹ç›®åˆ—è¡¨
        # æˆ–è‡ªåŠ¨å‘ç°é¡¹ç›®
        pass

    async def load_all_graphs(self):
        """åŠ è½½æ‰€æœ‰é¡¹ç›®çš„å›¾è°±"""
        for project_path in self.projects:
            # åŠ è½½æœ€æ–°å›¾è°±
            latest_graph = await self.load_latest_graph(project_path)

            # åŠ è½½å†å²å¿«ç…§
            history = await self.load_graph_history(project_path)

            self.projects[project_path] = {
                'latest': latest_graph,
                'history': history
            }
```

### 2. Webå¯è§†åŒ–ç•Œé¢

```typescript
// KnowledgeGraphViewer.tsx
interface GraphViewerProps {
    projects: Project[];
    currentProject?: string;
    viewMode: 'single' | 'compare' | 'timeline' | 'overview';
}

const KnowledgeGraphViewer: React.FC<GraphViewerProps> = ({
    projects,
    currentProject,
    viewMode
}) => {
    const [selectedGraph, setSelectedGraph] = useState(null);
    const [timeRange, setTimeRange] = useState([]);
    const [compareGraphs, setCompareGraphs] = useState([]);

    return (
        <div className="graph-viewer-container">
            {/* é¡¹ç›®é€‰æ‹©å™¨ */}
            <ProjectSelector
                projects={projects}
                onSelect={setCurrentProject}
            />

            {/* è§†å›¾æ¨¡å¼åˆ‡æ¢ */}
            <ViewModeSelector
                mode={viewMode}
                onChange={setViewMode}
            />

            {/* ä¸»è§†å›¾åŒºåŸŸ */}
            <div className="main-view">
                {viewMode === 'single' && (
                    <SingleGraphView graph={selectedGraph} />
                )}

                {viewMode === 'compare' && (
                    <CompareGraphView graphs={compareGraphs} />
                )}

                {viewMode === 'timeline' && (
                    <TimelineView
                        project={currentProject}
                        range={timeRange}
                    />
                )}

                {viewMode === 'overview' && (
                    <OverviewDashboard projects={projects} />
                )}
            </div>

            {/* è¯¦æƒ…é¢æ¿ */}
            <DetailsPanel />
        </div>
    );
};
```

### 3. å¤šç§å¯è§†åŒ–æ¨¡å¼

#### 3.1 å•é¡¹ç›®è§†å›¾
```javascript
// å±•ç¤ºå•ä¸ªé¡¹ç›®çš„å®Œæ•´å›¾è°±
class SingleGraphView {
    render() {
        return (
            <ForceGraph3D
                graphData={this.graphData}
                nodeLabel="name"
                nodeColor={node => this.getNodeColor(node.type)}
                linkDirectionalArrowLength={3.5}
                linkDirectionalArrowRelPos={1}
                onNodeClick={this.handleNodeClick}
                onNodeHover={this.handleNodeHover}
            />
        );
    }
}
```

#### 3.2 å¯¹æ¯”è§†å›¾
```javascript
// å¯¹æ¯”ä¸¤ä¸ªæˆ–å¤šä¸ªå›¾è°±
class CompareGraphView {
    render() {
        return (
            <div className="compare-container">
                <div className="graph-left">
                    <Graph data={this.graph1} />
                    <Stats data={this.stats1} />
                </div>

                <div className="diff-center">
                    <DiffVisualization
                        added={this.added}
                        removed={this.removed}
                        modified={this.modified}
                    />
                </div>

                <div className="graph-right">
                    <Graph data={this.graph2} />
                    <Stats data={this.stats2} />
                </div>
            </div>
        );
    }
}
```

#### 3.3 æ—¶é—´è½´è§†å›¾
```javascript
// å±•ç¤ºé¡¹ç›®æ¼”åŒ–å†ç¨‹
class TimelineView {
    render() {
        return (
            <div className="timeline-container">
                {/* æ—¶é—´è½´æ§åˆ¶å™¨ */}
                <TimeSlider
                    range={this.timeRange}
                    onChange={this.handleTimeChange}
                />

                {/* åŠ¨ç”»æ’­æ”¾æ§åˆ¶ */}
                <PlaybackControls
                    onPlay={this.startAnimation}
                    onPause={this.pauseAnimation}
                    speed={this.animationSpeed}
                />

                {/* å›¾è°±åŠ¨ç”»å±•ç¤º */}
                <AnimatedGraph
                    snapshots={this.snapshots}
                    currentTime={this.currentTime}
                />

                {/* äº‹ä»¶æ ‡è®° */}
                <EventMarkers
                    events={this.significantEvents}
                />
            </div>
        );
    }
}
```

#### 3.4 å…¨å±€æ¦‚è§ˆ
```javascript
// æ‰€æœ‰é¡¹ç›®çš„é¸Ÿç°è§†å›¾
class OverviewDashboard {
    render() {
        return (
            <div className="overview-grid">
                {this.projects.map(project => (
                    <ProjectCard
                        key={project.id}
                        project={project}
                        onClick={() => this.openProject(project)}
                    >
                        <MiniGraph data={project.latestGraph} />
                        <ProjectStats stats={project.stats} />
                        <RecentActivity activities={project.recent} />
                    </ProjectCard>
                ))}
            </div>
        );
    }
}
```

### 4. é«˜çº§äº¤äº’åŠŸèƒ½

```python
# advanced_interactions.py
class GraphInteractionEngine:
    """å›¾è°±äº¤äº’å¼•æ“"""

    async def search_across_projects(self, query: str):
        """è·¨é¡¹ç›®æœç´¢"""
        results = []
        for project in self.projects:
            matches = await self.search_in_graph(project.graph, query)
            results.extend(matches)
        return results

    async def find_similar_patterns(self, pattern):
        """æŸ¥æ‰¾ç›¸ä¼¼æ¨¡å¼"""
        similar = []
        for project in self.projects:
            if self.has_similar_pattern(project.graph, pattern):
                similar.append(project)
        return similar

    async def trace_dependency_chain(self, start_node, end_node):
        """è¿½è¸ªä¾èµ–é“¾"""
        path = self.find_shortest_path(start_node, end_node)
        return self.visualize_path(path)

    async def analyze_evolution(self, component):
        """åˆ†æç»„ä»¶æ¼”åŒ–"""
        history = []
        for snapshot in self.snapshots:
            if component in snapshot:
                history.append({
                    'time': snapshot.timestamp,
                    'state': snapshot.get_component_state(component),
                    'changes': snapshot.get_changes(component)
                })
        return history
```

### 5. æ™ºèƒ½åˆ†æé¢æ¿

```python
# intelligence_panel.py
class IntelligencePanel:
    """æ™ºèƒ½åˆ†æé¢æ¿"""

    def generate_insights(self, graph):
        """ç”Ÿæˆæ´å¯Ÿ"""
        return {
            'health_score': self.calculate_health_score(graph),
            'complexity_analysis': self.analyze_complexity(graph),
            'bottlenecks': self.find_bottlenecks(graph),
            'recommendations': self.generate_recommendations(graph),
            'predictions': self.predict_future_issues(graph)
        }

    def calculate_health_score(self, graph):
        """è®¡ç®—å¥åº·è¯„åˆ†"""
        factors = {
            'modularity': self.assess_modularity(graph),
            'coupling': self.assess_coupling(graph),
            'complexity': self.assess_complexity(graph),
            'test_coverage': self.assess_test_coverage(graph)
        }
        return sum(factors.values()) / len(factors)
```

## å®Œæ•´å®ç°ä»£ç 

### å¯è§†åŒ–æœåŠ¡å™¨
```python
# visualization_server.py
from fastapi import FastAPI, WebSocket
from fastapi.staticfiles import StaticFiles
from fastapi.responses import HTMLResponse
import json
import asyncio
from typing import Dict, List, Any

from src.mcp_core.services.project_memory_system import ProjectMemorySystem
from src.mcp_core.services.project_graph_generator import GraphGenerator

app = FastAPI()

class VisualizationServer:
    """å¯è§†åŒ–æœåŠ¡å™¨"""

    def __init__(self):
        self.memory_systems = {}  # æ¯ä¸ªé¡¹ç›®çš„è®°å¿†ç³»ç»Ÿ
        self.graph_generators = {}  # æ¯ä¸ªé¡¹ç›®çš„å›¾è°±ç”Ÿæˆå™¨
        self.active_connections = []  # WebSocketè¿æ¥

    async def initialize(self):
        """åˆå§‹åŒ–æœåŠ¡å™¨"""
        # åŠ è½½æ‰€æœ‰é¡¹ç›®
        await self.load_all_projects()

        # å¯åŠ¨åå°ä»»åŠ¡
        asyncio.create_task(self.monitor_changes())

    async def load_all_projects(self):
        """åŠ è½½æ‰€æœ‰é¡¹ç›®çš„å›¾è°±"""
        # ä»é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“è¯»å–é¡¹ç›®åˆ—è¡¨
        project_paths = self.get_project_list()

        for path in project_paths:
            # åˆ›å»ºè®°å¿†ç³»ç»Ÿå®ä¾‹
            memory = ProjectMemorySystem(f"{path}/.mcp_memory")
            self.memory_systems[path] = memory

            # åˆ›å»ºå›¾è°±ç”Ÿæˆå™¨
            generator = GraphGenerator()
            self.graph_generators[path] = generator

            # åŠ è½½æœ€æ–°å¿«ç…§
            latest = await memory.get_recent_snapshots(path, limit=1)
            if latest:
                await self.broadcast_graph_update(path, latest[0])

    async def get_project_list(self) -> List[str]:
        """è·å–é¡¹ç›®åˆ—è¡¨"""
        # å¯ä»¥ä»é…ç½®æ–‡ä»¶è¯»å–
        # æˆ–æ‰«æç‰¹å®šç›®å½•
        # æˆ–ä»æ•°æ®åº“æŸ¥è¯¢
        return [
            "/Users/mac/Downloads/MCP",
            # æ·»åŠ æ›´å¤šé¡¹ç›®...
        ]

    async def get_all_graphs(self) -> Dict[str, Any]:
        """è·å–æ‰€æœ‰é¡¹ç›®çš„å›¾è°±"""
        graphs = {}

        for path, memory in self.memory_systems.items():
            snapshots = await memory.get_recent_snapshots(path, limit=1)
            if snapshots:
                graphs[path] = {
                    'latest': self.serialize_graph(snapshots[0].graph_data),
                    'timestamp': snapshots[0].timestamp.isoformat(),
                    'stats': {
                        'nodes': len(snapshots[0].graph_data.nodes),
                        'edges': len(snapshots[0].graph_data.edges)
                    }
                }

        return graphs

    async def get_project_timeline(self, project_path: str, limit: int = 50):
        """è·å–é¡¹ç›®æ—¶é—´çº¿"""
        memory = self.memory_systems.get(project_path)
        if not memory:
            return []

        snapshots = await memory.get_recent_snapshots(project_path, limit)

        timeline = []
        for snapshot in snapshots:
            timeline.append({
                'id': snapshot.id,
                'timestamp': snapshot.timestamp.isoformat(),
                'trigger': snapshot.metadata.get('trigger', 'unknown'),
                'stats': {
                    'nodes': len(snapshot.graph_data.nodes),
                    'edges': len(snapshot.graph_data.edges)
                },
                'insights': snapshot.insights
            })

        return timeline

    async def compare_graphs(self, path1: str, time1: str, path2: str, time2: str):
        """å¯¹æ¯”ä¸¤ä¸ªå›¾è°±"""
        # åŠ è½½ä¸¤ä¸ªå¿«ç…§
        snapshot1 = await self.load_snapshot_by_time(path1, time1)
        snapshot2 = await self.load_snapshot_by_time(path2, time2)

        if not snapshot1 or not snapshot2:
            return None

        # è®¡ç®—å·®å¼‚
        diff = self.calculate_diff(snapshot1.graph_data, snapshot2.graph_data)

        return {
            'graph1': self.serialize_graph(snapshot1.graph_data),
            'graph2': self.serialize_graph(snapshot2.graph_data),
            'diff': diff,
            'similarity': self.calculate_similarity(
                snapshot1.graph_data,
                snapshot2.graph_data
            )
        }

    def serialize_graph(self, graph_data):
        """åºåˆ—åŒ–å›¾è°±æ•°æ®"""
        return {
            'nodes': [
                {
                    'id': n.id,
                    'name': n.name,
                    'type': n.type,
                    'path': n.path,
                    'size': n.size,
                    'complexity': n.complexity,
                    'metadata': n.metadata
                }
                for n in graph_data.nodes
            ],
            'edges': [
                {
                    'source': e.source,
                    'target': e.target,
                    'type': e.type,
                    'weight': e.weight
                }
                for e in graph_data.edges
            ]
        }

    async def broadcast_graph_update(self, project_path: str, snapshot):
        """å¹¿æ’­å›¾è°±æ›´æ–°"""
        message = {
            'type': 'graph_update',
            'project': project_path,
            'snapshot': {
                'id': snapshot.id,
                'timestamp': snapshot.timestamp.isoformat(),
                'graph': self.serialize_graph(snapshot.graph_data)
            }
        }

        for connection in self.active_connections:
            await connection.send_json(message)

    async def monitor_changes(self):
        """ç›‘æ§é¡¹ç›®å˜åŒ–"""
        while True:
            await asyncio.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥

            for path, memory in self.memory_systems.items():
                # æ£€æŸ¥æ˜¯å¦æœ‰æ–°å¿«ç…§
                latest = await memory.get_recent_snapshots(path, limit=1)
                if latest:
                    # å¹¿æ’­æ›´æ–°
                    await self.broadcast_graph_update(path, latest[0])

# åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
viz_server = VisualizationServer()

@app.on_event("startup")
async def startup():
    """å¯åŠ¨æ—¶åˆå§‹åŒ–"""
    await viz_server.initialize()

@app.get("/")
async def root():
    """ä¸»é¡µ"""
    return HTMLResponse(content=open("visualization_portal.html").read())

@app.get("/api/projects")
async def get_projects():
    """è·å–æ‰€æœ‰é¡¹ç›®"""
    return await viz_server.get_all_graphs()

@app.get("/api/project/{project_path}/timeline")
async def get_timeline(project_path: str, limit: int = 50):
    """è·å–é¡¹ç›®æ—¶é—´çº¿"""
    return await viz_server.get_project_timeline(project_path, limit)

@app.get("/api/compare")
async def compare(path1: str, time1: str, path2: str, time2: str):
    """å¯¹æ¯”å›¾è°±"""
    return await viz_server.compare_graphs(path1, time1, path2, time2)

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    """WebSocketç«¯ç‚¹"""
    await websocket.accept()
    viz_server.active_connections.append(websocket)

    try:
        while True:
            data = await websocket.receive_text()
            # å¤„ç†å®¢æˆ·ç«¯æ¶ˆæ¯
            message = json.loads(data)

            if message['type'] == 'request_graph':
                graphs = await viz_server.get_all_graphs()
                await websocket.send_json({
                    'type': 'graph_data',
                    'data': graphs
                })

    except Exception as e:
        viz_server.active_connections.remove(websocket)

# é™æ€æ–‡ä»¶æœåŠ¡
app.mount("/static", StaticFiles(directory="static"), name="static")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8888)
```

### å‰ç«¯HTMLç•Œé¢
```html
<!-- visualization_portal.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MCPçŸ¥è¯†å›¾è°±å¯è§†åŒ–ä¸­å¿ƒ</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .graph-container {
            flex: 1;
            position: relative;
        }

        #graph-3d {
            width: 100%;
            height: 100%;
        }

        .project-list {
            list-style: none;
        }

        .project-item {
            padding: 10px;
            margin: 5px 0;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .project-item:hover {
            background: #e0e0e0;
            transform: translateX(5px);
        }

        .project-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .view-modes {
            display: flex;
            gap: 10px;
        }

        .view-mode-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-mode-btn.active {
            background: #667eea;
            color: white;
        }

        .stats-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            min-width: 200px;
        }

        .timeline-slider {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>ğŸ“Š çŸ¥è¯†å›¾è°±ä¸­å¿ƒ</h1>

        <h3>é¡¹ç›®åˆ—è¡¨</h3>
        <ul class="project-list" id="project-list">
            <!-- åŠ¨æ€åŠ è½½é¡¹ç›® -->
        </ul>

        <h3>è§†å›¾æ¨¡å¼</h3>
        <div class="view-modes">
            <button class="view-mode-btn active" data-mode="3d">3Dè§†å›¾</button>
            <button class="view-mode-btn" data-mode="2d">2Dè§†å›¾</button>
            <button class="view-mode-btn" data-mode="timeline">æ—¶é—´è½´</button>
            <button class="view-mode-btn" data-mode="compare">å¯¹æ¯”</button>
        </div>

        <h3>æœç´¢</h3>
        <input type="text" id="search" placeholder="æœç´¢èŠ‚ç‚¹..." style="width: 100%; padding: 8px;">

        <h3>è¿‡æ»¤å™¨</h3>
        <div>
            <label><input type="checkbox" checked> Pythonæ–‡ä»¶</label><br>
            <label><input type="checkbox" checked> JavaScriptæ–‡ä»¶</label><br>
            <label><input type="checkbox" checked> é…ç½®æ–‡ä»¶</label>
        </div>
    </div>

    <div class="main-content">
        <div class="toolbar">
            <button onclick="resetView()">é‡ç½®è§†å›¾</button>
            <button onclick="toggleAnimation()">åŠ¨ç”»å¼€å…³</button>
            <button onclick="exportGraph()">å¯¼å‡º</button>
            <select id="layout-selector">
                <option value="force">åŠ›å¯¼å‘å¸ƒå±€</option>
                <option value="radial">å¾„å‘å¸ƒå±€</option>
                <option value="tree">æ ‘å½¢å¸ƒå±€</option>
            </select>
        </div>

        <div class="graph-container">
            <div id="graph-3d"></div>

            <div class="stats-panel">
                <h3>ç»Ÿè®¡ä¿¡æ¯</h3>
                <div id="stats">
                    <p>èŠ‚ç‚¹: <span id="node-count">0</span></p>
                    <p>è¿æ¥: <span id="edge-count">0</span></p>
                    <p>å¤æ‚åº¦: <span id="complexity">0</span></p>
                    <p>æœ€åæ›´æ–°: <span id="last-update">-</span></p>
                </div>
            </div>

            <div class="timeline-slider" style="display: none;">
                <h3>æ—¶é—´çº¿</h3>
                <input type="range" id="timeline" min="0" max="100" value="100" style="width: 100%;">
                <div id="timeline-info"></div>
            </div>
        </div>
    </div>

    <script>
        // WebSocketè¿æ¥
        const ws = new WebSocket('ws://localhost:8888/ws');

        // 3Då›¾è°±å®ä¾‹
        let graph3D = null;
        let currentProject = null;
        let graphData = { nodes: [], links: [] };

        // åˆå§‹åŒ–3Då›¾è°±
        function initGraph3D() {
            const container = document.getElementById('graph-3d');

            graph3D = ForceGraph3D()(container)
                .graphData(graphData)
                .nodeLabel('name')
                .nodeColor(node => getNodeColor(node.type))
                .linkDirectionalArrowLength(3.5)
                .linkDirectionalArrowRelPos(1)
                .onNodeClick(handleNodeClick)
                .onNodeHover(handleNodeHover);
        }

        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            const response = await fetch('/api/projects');
            const projects = await response.json();

            const list = document.getElementById('project-list');
            list.innerHTML = '';

            for (const [path, project] of Object.entries(projects)) {
                const li = document.createElement('li');
                li.className = 'project-item';
                li.innerHTML = `
                    <strong>${path.split('/').pop()}</strong><br>
                    <small>èŠ‚ç‚¹: ${project.stats.nodes} | è¾¹: ${project.stats.edges}</small>
                `;
                li.onclick = () => loadProject(path, project);
                list.appendChild(li);
            }
        }

        // åŠ è½½é¡¹ç›®å›¾è°±
        function loadProject(path, project) {
            currentProject = path;

            // æ›´æ–°å›¾è°±æ•°æ®
            graphData = {
                nodes: project.latest.nodes,
                links: project.latest.edges.map(e => ({
                    source: e.source,
                    target: e.target,
                    value: e.weight
                }))
            };

            // æ›´æ–°3Då›¾è°±
            if (graph3D) {
                graph3D.graphData(graphData);
            }

            // æ›´æ–°ç»Ÿè®¡
            updateStats(project.stats);

            // é«˜äº®é€‰ä¸­çš„é¡¹ç›®
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.project-item').classList.add('active');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(stats) {
            document.getElementById('node-count').textContent = stats.nodes;
            document.getElementById('edge-count').textContent = stats.edges;
            document.getElementById('last-update').textContent = new Date().toLocaleString();
        }

        // èŠ‚ç‚¹é¢œè‰²æ˜ å°„
        function getNodeColor(type) {
            const colors = {
                'python': '#3776ab',
                'javascript': '#f7df1e',
                'typescript': '#3178c6',
                'config': '#ff6b6b',
                'data': '#4ecdc4'
            };
            return colors[type] || '#95a5a6';
        }

        // èŠ‚ç‚¹ç‚¹å‡»å¤„ç†
        function handleNodeClick(node) {
            console.log('Clicked node:', node);
            // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦æƒ…
            showNodeDetails(node);
        }

        // èŠ‚ç‚¹æ‚¬åœå¤„ç†
        function handleNodeHover(node) {
            // é«˜äº®ç›¸å…³èŠ‚ç‚¹å’Œè¿æ¥
        }

        // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦æƒ…
        function showNodeDetails(node) {
            // åˆ›å»ºè¯¦æƒ…å¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
            `;

            modal.innerHTML = `
                <h2>${node.name}</h2>
                <p>è·¯å¾„: ${node.path}</p>
                <p>ç±»å‹: ${node.type}</p>
                <p>å¤§å°: ${node.size} bytes</p>
                <p>å¤æ‚åº¦: ${node.complexity}</p>
                <button onclick="this.parentElement.remove()">å…³é—­</button>
            `;

            document.body.appendChild(modal);
        }

        // è§†å›¾æ¨¡å¼åˆ‡æ¢
        document.querySelectorAll('.view-mode-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.view-mode-btn').forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');

                const mode = this.dataset.mode;
                switchViewMode(mode);
            };
        });

        // åˆ‡æ¢è§†å›¾æ¨¡å¼
        function switchViewMode(mode) {
            if (mode === 'timeline') {
                document.querySelector('.timeline-slider').style.display = 'block';
                loadTimeline();
            } else {
                document.querySelector('.timeline-slider').style.display = 'none';
            }
        }

        // åŠ è½½æ—¶é—´è½´
        async function loadTimeline() {
            if (!currentProject) return;

            const response = await fetch(`/api/project/${encodeURIComponent(currentProject)}/timeline`);
            const timeline = await response.json();

            // æ›´æ–°æ—¶é—´è½´æ»‘å—
            const slider = document.getElementById('timeline');
            slider.max = timeline.length - 1;
            slider.value = timeline.length - 1;

            slider.oninput = function() {
                const snapshot = timeline[this.value];
                document.getElementById('timeline-info').textContent =
                    `${snapshot.timestamp} - ${snapshot.trigger}`;
                // åŠ è½½å¯¹åº”æ—¶é—´ç‚¹çš„å›¾è°±
                // loadSnapshot(snapshot.id);
            };
        }

        // æœç´¢åŠŸèƒ½
        document.getElementById('search').oninput = function() {
            const term = this.value.toLowerCase();

            // é«˜äº®åŒ¹é…çš„èŠ‚ç‚¹
            graphData.nodes.forEach(node => {
                node.highlight = node.name.toLowerCase().includes(term);
            });

            graph3D.nodeColor(node =>
                node.highlight ? '#ff0000' : getNodeColor(node.type)
            );
        };

        // WebSocketæ¶ˆæ¯å¤„ç†
        ws.onmessage = function(event) {
            const message = JSON.parse(event.data);

            if (message.type === 'graph_update') {
                // å®æ—¶æ›´æ–°å›¾è°±
                if (message.project === currentProject) {
                    loadProject(message.project, {
                        latest: message.snapshot.graph,
                        stats: {
                            nodes: message.snapshot.graph.nodes.length,
                            edges: message.snapshot.graph.edges.length
                        }
                    });
                }
            }
        };

        // é‡ç½®è§†å›¾
        function resetView() {
            if (graph3D) {
                graph3D.zoomToFit(400);
            }
        }

        // å¯¼å‡ºå›¾è°±
        function exportGraph() {
            const dataStr = JSON.stringify(graphData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportLink = document.createElement('a');
            exportLink.setAttribute('href', dataUri);
            exportLink.setAttribute('download', 'graph.json');
            document.body.appendChild(exportLink);
            exportLink.click();
            document.body.removeChild(exportLink);
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            initGraph3D();
            loadProjects();
        };
    </script>
</body>
</html>
```

## é›†æˆæ–¹æ¡ˆ

### 1. ä¸ç°æœ‰MCPç³»ç»Ÿé›†æˆ

```python
# mcp_server_enterprise.py æ·»åŠ 
class MCPServerWithVisualization(MCPServer):
    """å¸¦å¯è§†åŒ–åŠŸèƒ½çš„MCPæœåŠ¡å™¨"""

    def __init__(self):
        super().__init__()
        self.viz_server = VisualizationServer()

    async def start(self):
        """å¯åŠ¨æœåŠ¡å™¨"""
        await super().start()

        # å¯åŠ¨å¯è§†åŒ–æœåŠ¡
        await self.viz_server.initialize()

        # æ³¨å†Œè·¯ç”±
        self.app.mount("/viz", self.viz_server.app)
```

### 2. ç‹¬ç«‹éƒ¨ç½²

```yaml
# docker-compose.yml
services:
  viz-portal:
    image: mcp-viz-portal:latest
    ports:
      - "8888:8888"
    volumes:
      - ./project_memory:/data
    environment:
      - MCP_PROJECTS=/data/projects.json
```

## ä½¿ç”¨åœºæ™¯

1. **é¡¹ç›®ç»ç†** - æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®çš„å¥åº·çŠ¶æ€
2. **æ¶æ„å¸ˆ** - åˆ†æç³»ç»Ÿæ¶æ„æ¼”åŒ–
3. **å¼€å‘è€…** - ç†è§£ä»£ç ä¾èµ–å…³ç³»
4. **æ–°äººåŸ¹è®­** - å¿«é€Ÿäº†è§£é¡¹ç›®ç»“æ„
5. **ä»£ç å®¡æŸ¥** - å‘ç°æ½œåœ¨é—®é¢˜

## æ€»ç»“

é€šè¿‡è¿™ä¸ªå¯è§†åŒ–ä¸­å¿ƒï¼ŒMCPç”¨æˆ·å¯ä»¥ï¼š
- ğŸ“Š åœ¨ç»Ÿä¸€ç•Œé¢æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®çš„çŸ¥è¯†å›¾è°±
- â° è¿›è¡Œæ—¶é—´æ—…è¡Œï¼ŒæŸ¥çœ‹å†å²çŠ¶æ€
- ğŸ” å¯¹æ¯”ä¸åŒé¡¹ç›®æˆ–æ—¶é—´ç‚¹
- ğŸ¯ æ·±å…¥æ¢ç´¢æ¯ä¸ªèŠ‚ç‚¹
- ğŸ’¡ è·å¾—æ™ºèƒ½åˆ†æå’Œå»ºè®®

è¿™å°†æå¤§æå‡é¡¹ç›®ç†è§£å’Œç®¡ç†æ•ˆç‡ï¼